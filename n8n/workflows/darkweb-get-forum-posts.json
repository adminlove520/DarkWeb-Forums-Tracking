{
  "name": "darkweb-get-forum-posts",
  "nodes": [
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"task_status\": {\n      \"type\": \"string\",\n      \"enum\": [\"success\", \"failed\"],\n      \"description\": \"Status of the forum parsing task\"\n    },\n    \"failed_cause\": {\n      \"type\": \"string\",\n      \"enum\": [\"login_needed\", \"bot_captcha\", \"page_unreachable\"],\n      \"description\": \"Reason for task failure (only present when task_status is 'failed')\"\n    },\n    \"error_details\": {\n      \"type\": \"string\",\n      \"description\": \"Additional details about the error (optional for failed tasks)\"\n    },\n    \"forum_posts\": {\n      \"type\": \"array\",\n      \"description\": \"Array of forum threads extracted from the forum page (only present when task_status is 'success')\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"post_title\": {\n            \"type\": \"string\",\n            \"description\": \"The title/subject of the forum thread as displayed on the forum, with pagination indicators removed\"\n          },\n          \"post_link\": {\n            \"type\": \"string\",\n            \"description\": \"Complete URL to the thread, constructed as base forum URL + thread path\"\n          },\n          \"post_author_name\": {\n            \"type\": \"string\",\n            \"description\": \"Username of the thread creator/original poster\"\n          },\n          \"post_author_link\": {\n            \"type\": \"string\",\n            \"description\": \"Profile URL of the thread author, constructed as base forum URL + '/User-' + username\"\n          },\n          \"post_date\": {\n            \"type\": \"string\",\n            \"format\": \"date-time\",\n            \"description\": \"Original post creation timestamp in ISO 8601 format (e.g., '2023-11-17T17:14:00+02:00'), converted from forum's raw date format\"\n          },\n          \"last_post_date\": {\n            \"type\": \"string\",\n            \"format\": \"date-time\",\n            \"description\": \"Last activity timestamp in ISO 8601 format (e.g., '2025-07-24T18:43:00+02:00'), converted from relative time format using current_timestamp as reference\"\n          },\n          \"last_post_author\": {\n            \"type\": \"string\",\n            \"description\": \"Username of the last person to post/reply in the thread\"\n          },\n          \"last_post_author_link\": {\n            \"type\": \"string\",\n            \"description\": \"Profile URL of the last activity author, constructed as base forum URL + '/User-' + username\"\n          }\n        },\n        \"required\": [\n          \"post_title\",\n          \"post_link\", \n          \"post_author_name\",\n          \"post_author_link\",\n          \"post_date\",\n          \"last_post_date\",\n          \"last_post_author\",\n          \"last_post_author_link\"\n        ],\n        \"additionalProperties\": false\n      }\n    }\n  },\n  \"required\": [\"task_status\"],\n  \"if\": {\n    \"properties\": {\n      \"task_status\": {\n        \"const\": \"success\"\n      }\n    }\n  },\n  \"then\": {\n    \"required\": [\"forum_posts\"],\n    \"not\": {\"required\": [\"failed_cause\"]}\n  },\n  \"else\": {\n    \"if\": {\n      \"properties\": {\n        \"task_status\": {\"const\": \"failed\"}\n      }\n    },\n    \"then\": {\n      \"required\": [\"failed_cause\"],\n      \"not\": {\"required\": [\"forum_posts\"]}\n    }\n  },\n  \"additionalProperties\": false\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -896,
        208
      ],
      "id": "0fce51c7-b98f-40e6-a92a-a02243851f2f",
      "name": "ç»“æ„åŒ–è¾“å‡ºè§£æå™¨"
    },
    {
      "parameters": {
        "description": "=## ä½¿ç”¨æ€è€ƒ(Think)å·¥å…·\n\nåœ¨æ¥æ”¶åˆ°å·¥å…·ç»“æœåé‡‡å–ä»»ä½•æ“ä½œæˆ–å“åº”ä¹‹å‰ï¼Œè¯·ä½¿ç”¨æ€è€ƒå·¥å…·ä½œä¸ºè‰ç¨¿æœ¬æ¥ï¼š\n- åˆ—å‡ºé€‚ç”¨äºå½“å‰è®ºå›æå–è¯·æ±‚çš„å…·ä½“è§„åˆ™\n- æ£€æŸ¥å¯¼èˆªå’Œæ•°æ®è®¿é—®æ˜¯å¦æˆåŠŸ\n- éªŒè¯æå–çš„æ•°æ®æ˜¯å¦çœŸå®ï¼ˆè€Œéä¼ªé€ /ç¤ºä¾‹æ•°æ®ï¼‰\n- æ ¹æ®å®é™…ç»“æœè§„åˆ’æ­£ç¡®çš„å“åº”çŠ¶æ€\n\nä»¥ä¸‹æ˜¯åœ¨æ€è€ƒå·¥å…·ä¸­è¿­ä»£çš„ç¤ºä¾‹ï¼š\n\n<think_tool_example_1>\nDarkForums.io çš„è®ºå›é¡µé¢æå–è¯·æ±‚\n- éªŒè¯è§„åˆ™ï¼š\n  * å¿…é¡»æˆåŠŸå¯¼èˆªåˆ°å®é™…URL\n  * å¿…é¡»æ•è·çœŸå®çš„æµè§ˆå™¨å¿«ç…§\n  * å¿…é¡»ä»…ä»å¿«ç…§ä¸­æå–çœŸå®çš„å¸–å­æ•°æ®\n  * ç»ä¸ç”Ÿæˆä¼ªé€ /ç¤ºä¾‹æ•°æ®\n- çŠ¶æ€ç¡®å®šï¼š\n  * å¦‚æœå¯¼èˆªå¤±è´¥ â†’ \"page_unreachable\"\n  * å¦‚æœæ£€æµ‹åˆ° CAPTCHA/DDoS-Guard â†’ \"bot_captcha\"\n  * å¦‚æœé‡å®šå‘åˆ°ç™»å½• â†’ \"login_needed\"\n  * å¦‚æœæå–åˆ°çœŸå®æ•°æ® â†’ \"success\" \n- è®¡åˆ’ï¼šå¯¼èˆª â†’ å¿«ç…§ â†’ éªŒè¯çœŸå®å†…å®¹ â†’ ä»…æå–çœŸå®æ•°æ®\n</think_tool_example_1>\n\n<think_tool_example_2>\næµè§ˆå™¨å¯¼èˆªå·²å®Œæˆï¼Œæ­£åœ¨æ£€æŸ¥å¿«ç…§ç»“æœ\n- å¯¼èˆªçŠ¶æ€ï¼šâœ… æˆåŠŸ - æ— è¶…æ—¶æˆ–é”™è¯¯\n- å¿«ç…§å†…å®¹åˆ†æï¼š\n  * é¡µé¢æ˜¾ç¤ºï¼šå…·æœ‰å¸–å­åˆ—è¡¨çš„çœŸå®è®ºå›å¸ƒå±€\n  * å¸–å­æ ‡é¢˜å¯è§ï¼š\"Morocco PMMP Database\", \"Twitter Leak 200M\"\n  * ä½œè€…å¯è§ï¼š\"B4baYega\", \"Lucifer\" \n  * çœŸå®æ—¥æœŸï¼š\"1 minute ago\", \"40 minutes ago\"\n- æ•°æ®éªŒè¯ï¼š\n  * æ‰€æœ‰å¸–å­æ•°æ®å‡æ¥è‡ªå®é™…å¿«ç…§ âœ…\n  * æ²¡æœ‰åƒ \"Username\" æˆ– \"Example\" è¿™æ ·çš„ä¼ªé€ ç”¨æˆ·å âœ…\n  * URL æ˜¯çœŸå®çš„è®ºå›è·¯å¾„ âœ…\n- è®¡åˆ’ï¼šæå–çœŸå®æ•°æ®å¹¶è¿”å›åŒ…å«å®é™…è®ºå›å¸–å­çš„æˆåŠŸçŠ¶æ€\n</think_tool_example_2>\n\n<think_tool_example_3>\næµè§ˆå™¨å¯¼èˆªå°è¯•ç»“æœ\n- å¯¼èˆªçŠ¶æ€ï¼šâŒ å¤±è´¥ - 30ç§’åè¿æ¥è¶…æ—¶\n- é”™è¯¯è¯¦æƒ…ï¼š\"net::ERR_TIMED_OUT\"\n- å¿«ç…§ç»“æœï¼šæœªæ•è·å¯ç”¨å†…å®¹\n- å¯ç”¨æ•°æ®ï¼šæ—  - æ— æ³•æå–ä»»ä½•å†…å®¹\n- è§„åˆ™æ£€æŸ¥ï¼š\n  * æ— æ³•ç”Ÿæˆä¼ªé€ æ•°æ® âœ…\n  * å¿…é¡»æŠ¥å‘Šå¯¼èˆªå¤±è´¥ âœ…\n- è®¡åˆ’ï¼šè¿”å›å¤±è´¥çŠ¶æ€ï¼ŒåŒ…å« \"page_unreachable\" å’Œé”™è¯¯è¯¦æƒ…\n</think_tool_example_3>"
      },
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        -608,
        208
      ],
      "id": "dec4323d-eebe-46b2-992b-f3f65888bc9b",
      "name": "æ€è€ƒ(Think)å·¥å…·"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://mllfrjetoelmjmgdemlm.supabase.co/rest/v1/rpc/check_existing_forum_posts",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"post_links_to_check\": {{ $json.output.forum_posts.map(post => post.post_link).toJsonString() }}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -160,
        -304
      ],
      "id": "78ab9a0d-b84b-474b-826a-0830ccfb5060",
      "name": "Supabase RPC æ£€æŸ¥ç°æœ‰URL",
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 5000,
      "credentials": {
        "supabaseApi": {
          "id": "okGUlQOFiLX3NatJ",
          "name": "Supabase account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "mode": "combine",
        "advanced": true,
        "mergeByFields": {
          "values": [
            {
              "field1": "post_link",
              "field2": "existing_post_link"
            }
          ]
        },
        "joinMode": "keepNonMatches",
        "outputDataFrom": "input1",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        176,
        -544
      ],
      "id": "5c20cc93-12c7-4a30-b6eb-400a437e668e",
      "name": "åˆå¹¶ä»…æ–°URL",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "authentication": "webhook",
        "options": {
          "username": "DarkWeb Forums",
          "wait": false
        },
        "embeds": {
          "values": [
            {
              "description": "=### {{ $json.forum_name }}\n- {{ $json.forum_url_path }}",
              "author": "=ğŸ”„ è®ºå›è¿½è¸ªå·²å¯åŠ¨",
              "color": "#3498DB",
              "timestamp": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        -848,
        -304
      ],
      "id": "ddb72e5b-71e7-40e9-a8bb-444240271480",
      "name": "é€šçŸ¥å¼€å§‹è¿½è¸ª",
      "webhookId": "7b0843fe-ee9e-45de-8198-74a6adc41eb2",
      "credentials": {
        "discordWebhookApi": {
          "id": "RjbFciIefptLTUfH",
          "name": "Discord Darkforums Chat"
        }
      }
    },
    {
      "parameters": {
        "authentication": "webhook",
        "options": {
          "username": "DarkWeb Forums",
          "wait": true
        },
        "embeds": {
          "values": [
            {
              "description": "=### {{ $('å¾ªç¯URL').item.json.forum_name }}\n- {{ $('å¾ªç¯URL').item.json.forum_url_path }}\n> AI æ™ºèƒ½ä½“å°è¯•è·å–æ•°æ®ï¼Œä½†å‘ç”Ÿäº†é”™è¯¯ã€‚\n> {{ $json.output?.error_details || $json.error || $json.output.failed_cause || 'å‘ç”Ÿäº†æœªçŸ¥é”™è¯¯' }}\n`æŸ¥çœ‹å·¥ä½œæµæ—¥å¿— â€¢ éœ€è¦äººå·¥å®¡æŸ¥`",
              "author": "=âš ï¸ è®ºå›è¿½è¸ªå¤±è´¥",
              "color": "#E74C3C",
              "timestamp": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        -160,
        -48
      ],
      "id": "74bace14-f374-4807-9636-2068938fd3df",
      "name": "é€šçŸ¥è¿½è¸ªå¤±è´¥",
      "webhookId": "7b0843fe-ee9e-45de-8198-74a6adc41eb2",
      "executeOnce": true,
      "retryOnFail": false,
      "credentials": {
        "discordWebhookApi": {
          "id": "RjbFciIefptLTUfH",
          "name": "Discord Darkforums Chat"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "a6e494dc-8c00-4583-a950-510c65468f38",
              "leftValue": "={{ $json.forum_posts[0] }}",
              "rightValue": 0,
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        176,
        -304
      ],
      "id": "182864c4-00be-415b-8e4a-554e5fd6e0b0",
      "name": "æœ‰æ–°å¸–å­å—?"
    },
    {
      "parameters": {
        "authentication": "webhook",
        "options": {
          "username": "DarkWeb Forums",
          "wait": true
        },
        "embeds": {
          "values": [
            {
              "description": "=### {{ $('å¾ªç¯URL').item.json.forum_name }}\n- {{ $('å¾ªç¯URL').item.json.forum_url_path }}",
              "author": "=â›” æœªå‘ç°æ–°å¸–å­",
              "color": "#3498DB",
              "timestamp": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        176,
        -48
      ],
      "id": "9bdd7173-e138-41f4-9821-3619f5a840a6",
      "name": "é€šçŸ¥æœªå‘ç°æ–°å¸–å­",
      "webhookId": "7b0843fe-ee9e-45de-8198-74a6adc41eb2",
      "executeOnce": true,
      "credentials": {
        "discordWebhookApi": {
          "id": "RjbFciIefptLTUfH",
          "name": "Discord Darkforums Chat"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -1152,
        -544
      ],
      "id": "722af682-ae01-4768-a2c2-f25df02b97a8",
      "name": "å®šæ—¶è§¦å‘å™¨"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.task_status }}",
                    "rightValue": "success",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "305279dd-7b2b-471c-aba0-0c5fc195c520"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "success"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cd9e2a01-3870-4596-a50e-9288ac4fd972",
                    "leftValue": "={{ $json.output.task_status }}",
                    "rightValue": "failed",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "failed"
            }
          ]
        },
        "options": {
          "fallbackOutput": 1
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -512,
        -304
      ],
      "id": "b5514d01-cd5b-4a2b-a947-b49e7b7a74ce",
      "name": "åˆ‡æ¢æ™ºèƒ½ä½“è¾“å‡º",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1152,
        -304
      ],
      "id": "69625e39-4855-4f35-b1c8-c253b74f288d",
      "name": "å¾ªç¯URL",
      "executeOnce": false
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.forum_posts",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -160,
        -544
      ],
      "id": "956ed208-036b-44c7-a809-5a7ff3177291",
      "name": "æ‹†åˆ†è®ºå›å¸–å­"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "forum_posts",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        480,
        -544
      ],
      "id": "93cfe3b1-4905-4053-ab14-2c8c56c8a7a8",
      "name": "é‡ç»„æ–°å¸–å­æ•°ç»„"
    },
    {
      "parameters": {
        "tableId": "darkweb_forums",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "monitored_at",
              "fieldValue": "={{ $now.toISO() }}"
            },
            {
              "fieldId": "post_title",
              "fieldValue": "={{ $json.post.post_title }}"
            },
            {
              "fieldId": "post_link",
              "fieldValue": "={{ $json.post.post_link }}"
            },
            {
              "fieldId": "post_author_name",
              "fieldValue": "={{ $json.post.post_author_name }}"
            },
            {
              "fieldId": "post_author_link",
              "fieldValue": "={{ $json.post.post_author_link }}"
            },
            {
              "fieldId": "last_post_date",
              "fieldValue": "={{ $json.post.last_post_date }}"
            },
            {
              "fieldId": "last_post_author",
              "fieldValue": "={{ $json.post.last_post_author }}"
            },
            {
              "fieldId": "last_post_author_link",
              "fieldValue": "={{ $json.post.last_post_author_link }}"
            },
            {
              "fieldId": "forum_name",
              "fieldValue": "={{ $('å¾ªç¯URL').item.json.forum_name }}"
            },
            {
              "fieldId": "forum_url",
              "fieldValue": "={{ $('å¾ªç¯URL').item.json.forum_url_path }}"
            },
            {
              "fieldId": "post_alert",
              "fieldValue": "={{ $json.post_alert }}"
            },
            {
              "fieldId": "entity_name",
              "fieldValue": "={{ $json.entity_name }}"
            },
            {
              "fieldId": "post_date",
              "fieldValue": "={{ $json.post.post_date }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        480,
        -48
      ],
      "id": "b301cc8c-5503-47f4-982d-b58f605cf51b",
      "name": "æ·»åŠ å¸–å­åˆ°Supabase",
      "credentials": {
        "supabaseApi": {
          "id": "okGUlQOFiLX3NatJ",
          "name": "Supabase account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0a60ead9-cd31-4e48-b81c-71b347d84428",
              "name": "forum_name",
              "value": "DarkForums.io",
              "type": "string"
            },
            {
              "id": "dcdea795-8f21-4213-aa5f-0866bdc6f9e8",
              "name": "forum_icon",
              "value": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQCWBDE-GmAiY_vPK4mNsuaPC8-gpK7u7ZFf46RcYP2SBNH4i_UcHc35Uoggs4e3DjvPmw&usqp=CAU",
              "type": "string"
            },
            {
              "id": "b8c7e0f0-1936-4e51-82be-b0c577f42734",
              "name": "forum_url",
              "value": "https://darkforums.io",
              "type": "string"
            },
            {
              "id": "e084011b-ec05-4f17-bd25-d448a4ea3eb6",
              "name": "forum_url_path[0]",
              "value": "https://darkforums.io/Forum-Databases",
              "type": "string"
            },
            {
              "id": "86faa3a0-144a-4807-9843-9e0e1f12a3a4",
              "name": "forum_url_path[1]",
              "value": "https://darkforums.io/Forum-Other-Leaks",
              "type": "string"
            },
            {
              "id": "a9b1c2d3-e4f5-46a7-b8c9-d0e1f2a3b4c5",
              "name": "forum_url_path[2]",
              "value": "https://darkforums.io/Forum-Database-Discussion",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -848,
        -544
      ],
      "id": "66809d45-b46a-4e22-b843-c6f58a19a338",
      "name": "DarkForums.io å…ƒæ•°æ®"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        784,
        192
      ],
      "id": "5ba2e161-c303-462f-8508-03383208167b",
      "name": "ç­‰å¾…",
      "webhookId": "34f815ed-1095-4ad1-8a61-18b42ca04db0"
    },
    {
      "parameters": {
        "fieldToSplitOut": "forum_posts",
        "options": {
          "destinationFieldName": "post"
        }
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        480,
        -304
      ],
      "id": "ac027284-304c-48d3-84c5-863dab8e77a2",
      "name": "å†æ¬¡æ‹†åˆ†è®ºå›å¸–å­"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "jrZPgmOsShHkTEFl",
          "mode": "list",
          "cachedResultName": "darkweb-send-forum-posts-to-discord"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "forum_name": "={{ $json.forum_name }}",
            "forum_url_path": "={{ $json.forum_url }}",
            "forum_icon": "={{ $('å¾ªç¯URL').item.json.forum_icon }}",
            "post_id": "={{ $json.id }}",
            "post_title": "={{ $json.post_title }}",
            "post_link": "={{ $json.post_link }}",
            "post_author_name": "={{ $json.post_author_name }}",
            "post_author_link": "={{ $json.post_author_link }}",
            "last_post_date": "={{ $json.last_post_date }}",
            "last_post_author": "={{ $json.last_post_author }}",
            "last_post_author_link": "={{ $json.last_post_author_link }}",
            "screenshot_filename": "={{ $json.id }}-{{ $json.post_link.split('/').slice(3).join('/').replace(/[^a-zA-Z0-9-_]/g, '-') }}.jpeg",
            "post_date": "={{ $json.post_date }}",
            "post_alert": "={{ $json.post_alert }}",
            "entity_name": "={{ $json.entity_name }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "forum_name",
              "displayName": "forum_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "forum_url_path",
              "displayName": "forum_url_path",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "forum_icon",
              "displayName": "forum_icon",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "post_id",
              "displayName": "post_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "post_title",
              "displayName": "post_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "post_link",
              "displayName": "post_link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "post_author_name",
              "displayName": "post_author_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "post_author_link",
              "displayName": "post_author_link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "post_date",
              "displayName": "post_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "last_post_date",
              "displayName": "last_post_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "last_post_author",
              "displayName": "last_post_author",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "last_post_author_link",
              "displayName": "last_post_author_link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "screenshot_filename",
              "displayName": "screenshot_filename",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "post_alert",
              "displayName": "post_alert",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "entity_name",
              "displayName": "entity_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        784,
        -48
      ],
      "name": "å‘é€å¸–å­åˆ°Discord",
      "id": "0b35f9e1-b415-4868-b377-4f8fede9ca89",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=[\n  {\n    \"forum_url\": \"{{ $('å¾ªç¯URL').item.json.forum_url_path }}\",\n    \"current_timestamp\": \"{{ $now.toISO() }}\"\n  }\n]",
        "hasOutputParser": true,
        "needsFallback": true,
        "options": {
          "systemMessage": "=ä½ æ˜¯ä¸€ä¸ª AI æ™ºèƒ½ä½“ï¼Œè´Ÿè´£ä½¿ç”¨ Playwright MCP å·¥å…·ä» {{ $('å¾ªç¯URL').item.json.forum_name }} è®ºå›é¡µé¢è§£æ ARIA å¿«ç…§ YAML æ•°æ®ã€‚ä½ çš„ä»»åŠ¡æ˜¯æå–æœ‰å…³è®ºå›å¸–å­çš„ç»“æ„åŒ–ä¿¡æ¯ï¼Œå¹¶å°†å…¶æ±‡ç¼–æˆå…·æœ‰æ­£ç¡®çŠ¶æ€å¤„ç†çš„ JSON å“åº”ã€‚\n\n## é‡è¦ï¼šè¾“å‡ºçŠ¶æ€å¤„ç†\n\nä½ çš„å“åº”å¿…é¡»éµå¾ªä»¥ä¸‹çŠ¶æ€è§„åˆ™ï¼š\n\n### æˆåŠŸåœºæ™¯ (task_status: \"success\")\n- å½“ä½ æˆåŠŸè®¿é—®è®ºå›é¡µé¢å¹¶èƒ½æå–å¸–å­æ•°æ®æ—¶\n- è¾“å‡ºæ ¼å¼ï¼š`{\"task_status\": \"success\", \"forum_posts\": [...]}`\n- å³ä½¿æ˜¯ç©ºçš„ï¼ˆæœªæ‰¾åˆ°å¸–å­ï¼‰ï¼Œä¹Ÿè¦åŒ…å« forum_posts æ•°ç»„\n- åœ¨æˆåŠŸå“åº”ä¸­**ç»ä¸**åŒ…å« \"failed_cause\"\n\n### å¤±è´¥åœºæ™¯ (task_status: \"failed\")\n- å½“ä½ å› ä»»ä½•åŸå› æ— æ³•å®Œæˆä»»åŠ¡æ—¶\n- è¾“å‡ºæ ¼å¼ï¼š`{\"task_status\": \"failed\", \"failed_cause\": \"reason\", \"error_details\": \"optional details\"}`\n- åœ¨å¤±è´¥å“åº”ä¸­**ç»ä¸**åŒ…å« \"forum_posts\"\n- **ç»ä¸**ç”Ÿæˆè™šæ‹Ÿ/ä¼ªé€ æ•°æ®\n\n**å¤±è´¥åŸå› é€‰é¡¹ï¼š**\n- `\"login_needed\"`: å½“é¡µé¢éœ€è¦è®¤è¯/ç™»å½•æ—¶\n- `\"bot_captcha\"`: å½“è¢«åçˆ¬è™«ç³»ç»Ÿã€CAPTCHA æˆ– Cloudflare ä¿æŠ¤é˜»æ­¢æ—¶\n- `\"page_unreachable\"`: å½“é¡µé¢ç¦»çº¿ã€è¿”å›é”™è¯¯ã€è¶…æ—¶æˆ–æ— æ³•è®¿é—®æ—¶\n\n---\n\n## æå–æ‰€éœ€æ•°æ®ï¼ˆä»…é™æˆåŠŸæƒ…å†µï¼‰\n\n### æ­¥éª¤ 1ï¼šå¯¼èˆªä¸æˆªå›¾\n\n1. ä½¿ç”¨ Think å·¥å…·è§„åˆ’ä½ çš„æ–¹æ³•\n2. ä½¿ç”¨ `browser_navigate` è®¿é—®ç›®æ ‡ URL\n3. ä½¿ç”¨ `browser_snapshot` æ•è·è®ºå›é¡µé¢å†…å®¹\n4. åˆ†æå“åº”ä»¥ç¡®å®šæ˜¯å¦å¯èƒ½æå–æ•°æ®\n\n### æ­¥éª¤ 2ï¼šçŠ¶æ€åˆ¤å®š\n\n**é¦–å…ˆæ£€æŸ¥è¿™äº›å¤±è´¥æ¡ä»¶ï¼š**\n- ç™»å½•æ‰€éœ€çš„é¡µé¢ / éœ€è¦è®¤è¯\n- åçˆ¬è™«ä¿æŠ¤ / CAPTCHA / Cloudflare æŒ‘æˆ˜\n- é¡µé¢é”™è¯¯ï¼ˆ404, 500, è¶…æ—¶ç­‰ï¼‰\n- æ— æ³•è®¿é—®çš„å†…å®¹\n\n**å¦‚æœæœ‰ä»»ä½•å¤±è´¥æ¡ä»¶è¢«æ£€æµ‹åˆ°ï¼š**\n- ç«‹å³è¿”å›å¸¦æœ‰é€‚å½“å¤±è´¥çŠ¶æ€çš„ç»“æœ\n- **ä¸è¦**å°è¯•æå–æ•°æ®\n- **ä¸è¦**ç”Ÿæˆä¼ªé€ /è™šæ‹Ÿæ•°æ®\n\n### æ­¥éª¤ 3ï¼šè§£æå¸–å­æ•°æ®ï¼ˆä»…é™æˆåŠŸï¼‰\n\n**æˆåŠŸè®¿é—®é¡µé¢çš„è¯´æ˜ï¼š**\n\n1. **å®šä½å¸–å­æ¡ç›®**ï¼š\n   - åœ¨ `table` æˆ– `rowgroup` ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾ `row` æˆ– `cell` æ¡ç›®ã€‚\n   - å¸–å­æ ‡é¢˜é€šå¸¸å‡ºç°åœ¨æ ‡è®°æœ‰æ˜æ˜¾æ¨¡å¼ï¼ˆå¦‚ `/url` ä¸­åŒ…å« `Thread-...` æˆ–åœ¨æåŠ \"by\" ä½œè€…çš„ä¸Šä¸‹æ–‡ä¸­ï¼‰çš„ `link` æ ‡ç­¾ä¸‹ã€‚\n\n2. **æå–æ¯ä¸ªå¸–å­çš„å­—æ®µ**ï¼š\n   - **post_title**ï¼šå¸–å­ä¸» `link` çš„æ–‡æœ¬å†…å®¹ã€‚\n   - **post_link**ï¼šè®ºå›åŸºç¡€ URL åŠ ä¸ŠåŒ…å« `Thread-...` ä¸”ä¸åŒ…å« `?action=lastpost` çš„ `link` URL è·¯å¾„ã€‚\n   - **post_author_name**ï¼šåœ¨ `by` é™„è¿‘æˆ–æåˆ°ä½œè€…ä¿¡æ¯çš„ `link` ä¸­çš„æ–‡æœ¬åç§°ã€‚\n   - **post_author_link**ï¼šåŒ…å« `/User-<username>` çš„ä½œè€… `link` URLã€‚\n   - **post_date**ï¼šåŸå§‹å¸–å­åˆ›å»ºæ—¥æœŸ/æ—¶é—´ï¼ˆé€šå¸¸å¦‚ \"17-11-23, 05:14 PM\"ï¼‰ã€‚ä½¿ç”¨è®ºå›çš„æ—¶åŒºä¸Šä¸‹æ–‡å°†å…¶è½¬æ¢ä¸º ISO 8601 æ ¼å¼ã€‚\n   - **last_post_date**ï¼šåœ¨ `Last Post` é“¾æ¥æˆ–é™„è¿‘å…ƒæ•°æ®ï¼ˆå¯èƒ½æ˜¯ç›¸å¯¹æ—¶é—´å¦‚ \"2 minutes ago\"ï¼‰é™„è¿‘æ‰¾åˆ°çš„æ—¥æœŸ/æ—¶é—´ã€‚ä½¿ç”¨æä¾›çš„ current_timestamp ä½œä¸ºå‚è€ƒè¿›è¡Œè½¬æ¢ã€‚\n   - **last_post_author**ï¼šåœ¨ `Last Post` éƒ¨åˆ†æ˜¾ç¤ºä¸ºæœ€æ–°å›å¤è€…çš„åç§°ã€‚\n   - **last_post_author_link**ï¼šæœ€æ–°å›å¤è€…åŒ…å« `/User-<username>` çš„é“¾æ¥ã€‚\n\n3. **æ—¥æœŸè½¬æ¢è§„åˆ™**ï¼š\n   - æ¥è‡ªç”¨æˆ·è¾“å…¥çš„ `current_timestamp` å¯¹äºå°†ç›¸å¯¹æ—¥æœŸï¼ˆå¦‚ \"2 minutes ago\"ï¼‰è½¬æ¢ä¸º ISO 8601 æ ¼å¼è‡³å…³é‡è¦ã€‚\n   - **å¯¹äº post_date**ï¼šä»è®ºå›æ ¼å¼ï¼ˆä¾‹å¦‚ \"17-11-23, 05:14 PM\"ï¼‰è½¬æ¢ä¸º ISO 8601ã€‚å‡è®¾è®ºå›çš„æ—¶åŒºä¸ current_timestamp æ—¶åŒºåŒ¹é…ã€‚\n   - **å¯¹äº last_post_date**ï¼š\n     - å¦‚æœæ˜¯ç›¸å¯¹çš„ï¼ˆä¾‹å¦‚ \"2 minutes ago\", \"1 hour ago\", \"Less than 1 minute ago\"ï¼‰ï¼Œä» current_timestamp å‘åè®¡ç®—\n     - å¦‚æœæ˜¯ç»å¯¹æ—¥æœŸæ ¼å¼ï¼Œç±»ä¼¼äº post_date è¿›è¡Œè½¬æ¢\n     - ç¤ºä¾‹ï¼ˆå‡è®¾ current_timestamp æ˜¯ \"{{ $now.toISO() }}\"ï¼‰ï¼š\n       - \"Less than 1 minute ago\" â†’ ä» {{ $now.toISO() }} å‡å» 30 ç§’ = \"{{ $now.minus({seconds: 30}).toISO() }}\"\n       - \"2 minutes ago\" â†’ ä» {{ $now.toISO() }} å‡å» 2 åˆ†é’Ÿ = \"{{ $now.minus({minutes: 2}).toISO() }}\"\n       - \"1 hour ago\" â†’ ä» {{ $now.toISO() }} å‡å» 1 å°æ—¶ = \"{{ $now.minus({hours: 1}).toISO() }}\"\n       - \"3 days ago\" â†’ ä» {{ $now.toISO() }} å‡å» 3 å¤© = \"{{ $now.minus({days: 3}).toISO() }}\"\n       - \"Yesterday at 3:45 PM\" â†’ è®¡ç®—åˆ°å‰ä¸€å¤©çš„ç‰¹å®šæ—¶é—´\n\n4. **è¿‡æ»¤**ï¼š\n   - å¿½ç•¥ä»…ä»…æ˜¯è®ºå›æ ‡é¢˜æˆ–åˆ†é¡µæ§ä»¶çš„è¡Œã€‚\n   - ç¡®ä¿è·³è¿‡ `Announcement` ç±»å‹çš„è¡Œï¼Œé™¤éå®ƒä»¬éµå¾ªç›¸åŒçš„ç»“æ„ã€‚\n\n5. **è¾“å‡º**ï¼š\n   - è¿”å›æ ¼å¼è‰¯å¥½çš„ JSONï¼ŒåŒ…å«æˆåŠŸçŠ¶æ€å’Œ forum_posts æ•°ç»„ã€‚\n   - ç¡®ä¿æ‰€æœ‰ URL éƒ½æ˜¯ç»å¯¹è·¯å¾„ï¼Œå¿…è¦æ—¶åœ¨å‰é¢åŠ ä¸Šè®ºå›åŸºç¡€ URLã€‚\n   - ç¡®ä¿æ‰€æœ‰æ—¥æœŸå‡ä¸ºåŒ…å«æ—¶åŒºä¿¡æ¯çš„æ­£ç¡® ISO 8601 æ ¼å¼ã€‚\n\n### æˆåŠŸè¾“å‡ºç¤ºä¾‹ï¼š\n\n```json\n{\n  \"task_status\": \"success\",\n  \"forum_posts\": [\n    {\n      \"post_title\": \"Example Leak\",\n      \"post_link\": \"{{ $('å¾ªç¯URL').item.json.forum_url_path }}/Thread-Example-Leak\",\n      \"post_author_name\": \"Username\",\n      \"post_author_link\": \"{{ $('å¾ªç¯URL').item.json.forum_url_path }}/User-Username\",\n      \"post_date\": \"2023-11-17T17:14:00+02:00\",\n      \"last_post_date\": \"2024-01-16T18:59:04.164+02:00\",\n      \"last_post_author\": \"Replier\",\n      \"last_post_author_link\": \"{{ $('å¾ªç¯URL').item.json.forum_url_path }}/User-Replier\"\n    }\n  ]\n}\n```\n\n### å¤±è´¥è¾“å‡ºç¤ºä¾‹ï¼š\n\n```json\n{\n  \"task_status\": \"failed\",\n  \"failed_cause\": \"bot_captcha\",\n  \"error_details\": \"Cloudflare protection detected on page\"\n}\n```\n\n```json\n{\n  \"task_status\": \"failed\",\n  \"failed_cause\": \"login_needed\",\n  \"error_details\": \"Page redirected to login form\"\n}\n```\n\n```json\n{\n  \"task_status\": \"failed\",\n  \"failed_cause\": \"page_unreachable\",\n  \"error_details\": \"HTTP 503 Service Unavailable\"\n}\n```\n\n---\n\n## åçˆ¬è™« (ANTI-BOT) å¤„ç†\n\n### ä»…å½“ browser_snapshot æ˜¾ç¤ºåçˆ¬è™«ä¿æŠ¤æ—¶ï¼š\n\n- ä½¿ç”¨ `browser_wait_for` ç­‰å¾…æ—¶é—´ï¼š10ï¼Œä»¥è‡ªåŠ¨ç»•è¿‡\n- å†æ¬¡æ‹æ‘„ `browser_snapshot` æ£€æŸ¥è®ºå›æ˜¯å¦åŠ è½½\n- å¦‚æœä»ç„¶è¢«å±è”½ï¼Œè¿”å›å¸¦æœ‰ \"bot_captcha\" åŸå› çš„å¤±è´¥çŠ¶æ€\n\n### ä»…å½“å‡ºç°éªŒè¯ç  (captcha) æ—¶ï¼š\n\n- ä½¿ç”¨ `browser_hover` ç„¶å `browser_click` ç‚¹å‡»éªŒè¯æŒ‰é’®\n- ä½¿ç”¨ `browser_wait_for` ç­‰å¾…æ—¶é—´ï¼š5\n- æ‹æ‘„æœ€ç»ˆ `browser_snapshot` ç”¨äºæå–\n- å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿”å›å¸¦æœ‰ \"bot_captcha\" åŸå› çš„å¤±è´¥çŠ¶æ€\n\n## å…³é”®æé†’\n\n1. **ç»ä¸ç”Ÿæˆä¼ªé€ /è™šæ‹Ÿæ•°æ®** - å¦‚æœæ— æ³•è®¿é—®çœŸå®æ•°æ®ï¼Œè¿”å›å¤±è´¥çŠ¶æ€\n2. **å§‹ç»ˆå…ˆç¡®å®šçŠ¶æ€** - åœ¨å°è¯•æå–ä¹‹å‰æ£€æŸ¥å¤±è´¥æƒ…å†µ\n3. **ä¸¥æ ¼éµå¾ª JSON æ¨¡å¼** - æˆåŠŸå“åº”éœ€è¦ forum_postsï¼Œå¤±è´¥å“åº”éœ€è¦ failed_cause\n4. **å¤±è´¥åŸå› è¦ç²¾ç¡®** - é’ˆå¯¹å…·ä½“æƒ…å†µä½¿ç”¨æ­£ç¡®çš„æšä¸¾å€¼\n5. **ä¸è¦æ··åˆå“åº”** - ç»ä¸è¦åœ¨åŒä¸€å“åº”ä¸­åŒæ—¶åŒ…å« forum_posts å’Œ failed_cause\n6. **æ—¥æœŸè½¬æ¢æ˜¯å¼ºåˆ¶æ€§çš„** - å¿…é¡»ä½¿ç”¨æä¾›çš„ current_timestamp ä½œä¸ºå‚è€ƒå°†æ‰€æœ‰æ—¥æœŸè½¬æ¢ä¸º ISO 8601 æ ¼å¼\n7. **æå– post_date å’Œ last_post_date** - è¿™ä¸¤ä¸ªç°åœ¨éƒ½æ˜¯æ¯ä¸ªè®ºå›å¸–å­çš„å¿…å¡«å­—æ®µ",
          "passthroughBinaryImages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -848,
        -48
      ],
      "id": "9bb9a2ee-ce01-465f-901f-d4dee2099499",
      "name": "AI æ™ºèƒ½ä½“",
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 5000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "sseEndpoint": "https://playwright-mcp.zeabur.app/sse",
        "include": "except",
        "excludeTools": [
          "browser_file_upload",
          "browser_install",
          "browser_pdf_save",
          "browser_drag",
          "browser_generate_playwright_test"
        ]
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        -464,
        208
      ],
      "id": "c0710347-a519-4d07-b406-6e1841bf95db",
      "name": "Playwright MCPå·¥å…·"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "894fbb6f-1112-4f6e-be85-b8ef55519296",
              "name": "keywords",
              "value": "=[\n  [\"lockbit\"],\n  [\"facebook\", \"meta\"],\n  [\"bank of america\", \"bak\"],\n  [\"visa\"],\n  [\"united states\", \"united states of america\", \" usa \", \"american\"],\n  [\"brasil\", \"brazil\", \".br\", \".com.br\", \"brazilian\"],\n  [\"sÃ£o paulo\", \"sao paulo\", \" sp \", \"saopaulo\"],\n  [\"breached\", \"breachforums\", \"breach forums\", \"breached-forums\"]\n]",
              "type": "array"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        784,
        -544
      ],
      "id": "d87533a9-3ef7-4596-8f42-070e07ef88b3",
      "name": "å…³é”®è¯",
      "notesInFlow": true,
      "notes": "This node defines the entity detection dictionary containing grouped arrays of companies and related terms. Each array represents one canonical entity (first element) followed by its variations, abbreviations, and common misspellings. For example, \"facebook\" includes variants like \"face\", \"fbook\", and \"meta\", enabling comprehensive detection of entity mentions regardless of how they're written in forum posts."
    },
    {
      "parameters": {
        "jsCode": "const { keywords } = $input.all()[0].json;\n\n  function normalizeText(text) {\n    return text.toLowerCase()\n      .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') // Remove accents\n      .replace(/[^\\w\\s]/g, ' ') // Replace special chars with spaces\n      .replace(/\\s+/g, ' ') // Normalize whitespace\n      .trim();\n  }\n\n  function findMatchingEntities(text, keywords) {\n    const normalizedText = normalizeText(text);\n    const matchedEntities = [];\n\n    keywords.forEach(group => {\n      const mainEntity = group[0];\n      const hasMatch = group.some(variant => {\n        const normalizedVariant = normalizeText(variant);\n\n        // Strategy based on variant characteristics:\n        if (normalizedVariant.length <= 3) {\n          // Short terms: exact word boundaries (avoid \"usa\" in \"usage\")\n          const regex = new RegExp(`\\\\b${normalizedVariant}\\\\b`, 'i');\n          return regex.test(normalizedText);\n        } else if (normalizedVariant.includes(' ')) {\n          // Multi-word terms: substring matching\n          return normalizedText.includes(normalizedVariant);\n        } else {\n          // Single words: try both approaches\n          const wordBoundary = new RegExp(`\\\\b${normalizedVariant}\\\\b`, 'i');\n          const substring = normalizedText.includes(normalizedVariant);\n          return wordBoundary.test(normalizedText) || substring;\n        }\n      });\n\n      if (hasMatch) {\n        matchedEntities.push(mainEntity);\n      }\n    });\n\n    return matchedEntities;\n  }\n\n  return $input.all().map(item => {\n    const postTitle = item.json.post?.post_title || '';\n    const foundEntities = findMatchingEntities(postTitle, keywords);\n\n    return {\n      post: item.json.post,\n      entity_name: foundEntities.length > 0 ? foundEntities : null,  // null when empty\n      post_alert: foundEntities.length > 0\n    };\n  });"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        784,
        -304
      ],
      "id": "b0ad90e0-c1f4-45ce-9568-169ed1ed1c21",
      "name": "å®ä½“åŒ¹é…ä»£ç ",
      "notesInFlow": true,
      "notes": "This node performs intelligent entity detection on forum post titles using text normalization and hybrid matching strategies. It processes each post title by removing accents, normalizing whitespace, and applying different matching approaches: exact word boundaries for short terms (â‰¤3 chars), substring matching for multi-word phrases, and combined word boundary + substring matching for single words. The output includes the original post data plus entity_name (array of detected entities or null) and keyword_alert (boolean flag), providing structured threat intelligence data for database storage."
    },
    {
      "parameters": {
        "fieldToSplitOut": "forum_url_path",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -512,
        -544
      ],
      "id": "4293d486-a32d-40f9-9806-d801437bd8c7",
      "name": "æ‹†åˆ†å¾…è¿½è¸ªURL"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        784,
        416
      ],
      "id": "6375f030-7208-47d5-a286-614dfbb04bc5",
      "name": "ç­‰å¾…é‡è¯•",
      "webhookId": "aa69297c-b4b6-401a-95d9-a1b00e81e5b3"
    },
    {
      "parameters": {
        "authentication": "webhook",
        "options": {
          "username": "DarkWeb Forums",
          "wait": true
        },
        "embeds": {
          "values": [
            {
              "description": "=### {{ $('å¾ªç¯URL').item.json.forum_name }}\n- {{ $('å¾ªç¯URL').item.json.forum_url_path }}\n> AI æ™ºèƒ½ä½“å°è¯•è·å–æ•°æ® **3æ¬¡** ä½†æœªèƒ½æˆåŠŸã€‚\n`æŸ¥çœ‹å·¥ä½œæµæ—¥å¿— â€¢ éœ€è¦äººå·¥å®¡æŸ¥`",
              "author": "=âš ï¸ è®ºå›è¿½è¸ªé‡è¯•å¤±è´¥",
              "color": "#E74C3C",
              "timestamp": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        176,
        192
      ],
      "id": "c14ea7f5-7ebc-4b1c-a024-9f0adad68714",
      "name": "é€šçŸ¥é‡è¯•å¤±è´¥",
      "webhookId": "7b0843fe-ee9e-45de-8198-74a6adc41eb2",
      "executeOnce": true,
      "retryOnFail": false,
      "credentials": {
        "discordWebhookApi": {
          "id": "RjbFciIefptLTUfH",
          "name": "Discord Darkforums Chat"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a86fbd7e-7add-4cd2-9107-58defd2f9eef",
              "leftValue": "={{ $runIndex }}",
              "rightValue": 2,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -160,
        192
      ],
      "id": "b48f6536-8945-409c-8ed7-7f19837aab94",
      "name": "é‡è¯•è®¡æ•° (2æ¬¡)"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -1136,
        -32
      ],
      "id": "68759977-5219-4ed2-8f0d-d6f8b4633e51",
      "name": "OpenAI Chat Model (GPT-4o)",
      "credentials": {
        "openAiApi": {
          "id": "openAiApi",
          "name": "OpenAI account"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -1136,
        208
      ],
      "id": "712c5b3b-432c-4deb-9aaf-cbfa7d90323d",
      "name": "OpenAI Chat Model (GPT-4o Mini)",
      "credentials": {
        "openAiApi": {
          "id": "openAiApi",
          "name": "OpenAI account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "webhook",
        "options": {
          "username": "DarkWeb Forums",
          "wait": false
        },
        "embeds": {
          "values": [
            {
              "description": "=### {{ $('å¾ªç¯URL').item.json.forum_name }}\n- {{ $('å¾ªç¯URL').item.json.forum_url_path }}\n`å°è¯•ç¬¬ ({{ $runIndex+1 }}) æ¬¡`",
              "author": "=ğŸ”„ æ–°çš„è®ºå›è¿½è¸ªå·²å¯åŠ¨",
              "color": "#3498DB",
              "timestamp": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        -1152,
        416
      ],
      "id": "423b713f-27d5-4afb-b4f4-d542ea104a3e",
      "name": "é€šçŸ¥å¼€å§‹æ–°é‡è¯•",
      "webhookId": "7b0843fe-ee9e-45de-8198-74a6adc41eb2",
      "credentials": {
        "discordWebhookApi": {
          "id": "RjbFciIefptLTUfH",
          "name": "Discord Darkforums Chat"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const allPosts = $(\"AI æ™ºèƒ½ä½“\").first().json.output?.forum_posts || [];\nconst now = new Date();\nconst twentyFourHoursAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n\nconst activePosts = allPosts.filter(post => {\n  const lastPostDate = new Date(post.last_post_date);\n  return lastPostDate >= twentyFourHoursAgo;\n});\n\nif (activePosts.length === 0) {\n  return { hasActivePosts: false };\n}\n\nconst recapList = activePosts.map(post => `- [${post.post_title}](${post.post_link})`).join('\\n');\n\nreturn {\n  hasActivePosts: true,\n  recap_message: `### ğŸ“Š ä»Šæ—¥æ´»è·ƒåŠ¨æ€å›é¡¾\\nä»¥ä¸‹æ˜¯è¿‡å» 24 å°æ—¶å†…æœ‰æ–°åŠ¨é™çš„å¸–å­ï¼š\\n\\n${recapList}`\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        480,
        -48
      ],
      "id": "recap-filter-node-1",
      "name": "ç­›é€‰ä»Šæ—¥æ´»è·ƒå¸–å­"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "c16d",
              "leftValue": "={{ $json.hasActivePosts }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        784,
        -48
      ],
      "id": "recap-if-node-1",
      "name": "æ˜¯å¦æœ‰æ´»è·ƒå¸–å­?"
    },
    {
      "parameters": {
        "authentication": "webhook",
        "options": {
          "username": "DarkWeb Forums",
          "wait": true
        },
        "embeds": {
          "values": [
            {
              "description": "={{ $json.recap_message }}",
              "author": "=ğŸ“‹ ä»Šæ—¥åŠ¨æ€æ±‡æ€» ({{ $('å¾ªç¯URL').item.json.forum_name }})",
              "color": "#F1C40F",
              "timestamp": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        1088,
        -160
      ],
      "id": "recap-discord-node-1",
      "name": "é€šçŸ¥ä»Šæ—¥æ´»è·ƒæ±‡æ€»",
      "webhookId": "7b0843fe-ee9e-45de-8198-74a6adc41eb2",
      "executeOnce": true,
      "credentials": {
        "discordWebhookApi": {
          "id": "RjbFciIefptLTUfH",
          "name": "Discord Darkforums Chat"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "ç»“æ„åŒ–è¾“å‡ºè§£æå™¨": {
      "ai_outputParser": [
        [
          {
            "node": "AI æ™ºèƒ½ä½“",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "æ€è€ƒ(Think)å·¥å…·": {
      "ai_tool": [
        [
          {
            "node": "AI æ™ºèƒ½ä½“",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RPC æ£€æŸ¥ç°æœ‰URL": {
      "main": [
        [
          {
            "node": "åˆå¹¶ä»…æ–°URL",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "é€šçŸ¥è¿½è¸ªå¤±è´¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆå¹¶ä»…æ–°URL": {
      "main": [
        [
          {
            "node": "é‡ç»„æ–°å¸–å­æ•°ç»„",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é€šçŸ¥å¼€å§‹è¿½è¸ª": {
      "main": [
        [
          {
            "node": "AI æ™ºèƒ½ä½“",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é€šçŸ¥è¿½è¸ªå¤±è´¥": {
      "main": [
        [
          {
            "node": "é‡è¯•è®¡æ•° (2æ¬¡)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æœ‰æ–°å¸–å­å—?": {
      "main": [
        [
          {
            "node": "å†æ¬¡æ‹†åˆ†è®ºå›å¸–å­",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ç­›é€‰ä»Šæ—¥æ´»è·ƒå¸–å­",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç­›é€‰ä»Šæ—¥æ´»è·ƒå¸–å­": {
      "main": [
        [
          {
            "node": "æ˜¯å¦æœ‰æ´»è·ƒå¸–å­?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ˜¯å¦æœ‰æ´»è·ƒå¸–å­?": {
      "main": [
        [
          {
            "node": "é€šçŸ¥ä»Šæ—¥æ´»è·ƒæ±‡æ€»",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "é€šçŸ¥æœªå‘ç°æ–°å¸–å­",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é€šçŸ¥æœªå‘ç°æ–°å¸–å­": {
      "main": [
        [
          {
            "node": "ç­‰å¾…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å®šæ—¶è§¦å‘å™¨": {
      "main": [
        [
          {
            "node": "DarkForums.io å…ƒæ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ‡æ¢æ™ºèƒ½ä½“è¾“å‡º": {
      "main": [
        [
          {
            "node": "Supabase RPC æ£€æŸ¥ç°æœ‰URL",
            "type": "main",
            "index": 0
          },
          {
            "node": "æ‹†åˆ†è®ºå›å¸–å­",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "é€šçŸ¥è¿½è¸ªå¤±è´¥",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "é€šçŸ¥è¿½è¸ªå¤±è´¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¾ªç¯URL": {
      "main": [
        [],
        [
          {
            "node": "é€šçŸ¥å¼€å§‹è¿½è¸ª",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ‹†åˆ†è®ºå›å¸–å­": {
      "main": [
        [
          {
            "node": "åˆå¹¶ä»…æ–°URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é‡ç»„æ–°å¸–å­æ•°ç»„": {
      "main": [
        [
          {
            "node": "æœ‰æ–°å¸–å­å—?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ·»åŠ å¸–å­åˆ°Supabase": {
      "main": [
        [
          {
            "node": "å‘é€å¸–å­åˆ°Discord",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ç­‰å¾…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DarkForums.io å…ƒæ•°æ®": {
      "main": [
        [
          {
            "node": "æ‹†åˆ†å¾…è¿½è¸ªURL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç­‰å¾…": {
      "main": [
        [
          {
            "node": "å¾ªç¯URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å†æ¬¡æ‹†åˆ†è®ºå›å¸–å­": {
      "main": [
        [
          {
            "node": "å…³é”®è¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‘é€å¸–å­åˆ°Discord": {
      "main": [
        [
          {
            "node": "ç­‰å¾…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI æ™ºèƒ½ä½“": {
      "main": [
        [
          {
            "node": "åˆ‡æ¢æ™ºèƒ½ä½“è¾“å‡º",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "é€šçŸ¥è¿½è¸ªå¤±è´¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Playwright MCPå·¥å…·": {
      "ai_tool": [
        [
          {
            "node": "AI æ™ºèƒ½ä½“",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "å…³é”®è¯": {
      "main": [
        [
          {
            "node": "å®ä½“åŒ¹é…ä»£ç ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å®ä½“åŒ¹é…ä»£ç ": {
      "main": [
        [
          {
            "node": "æ·»åŠ å¸–å­åˆ°Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ‹†åˆ†å¾…è¿½è¸ªURL": {
      "main": [
        [
          {
            "node": "å¾ªç¯URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç­‰å¾…é‡è¯•": {
      "main": [
        [
          {
            "node": "é€šçŸ¥å¼€å§‹æ–°é‡è¯•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é€šçŸ¥é‡è¯•å¤±è´¥": {
      "main": [
        [
          {
            "node": "ç­‰å¾…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é‡è¯•è®¡æ•° (2æ¬¡)": {
      "main": [
        [
          {
            "node": "é€šçŸ¥é‡è¯•å¤±è´¥",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ç­‰å¾…é‡è¯•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model (GPT-4o)": {
      "ai_languageModel": [
        [
          {
            "node": "AI æ™ºèƒ½ä½“",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Chat Model (GPT-4o Mini)": {
      "ai_languageModel": [
        [
          {
            "node": "ç»“æ„åŒ–è¾“å‡ºè§£æå™¨",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI æ™ºèƒ½ä½“",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "é€šçŸ¥å¼€å§‹æ–°é‡è¯•": {
      "main": [
        [
          {
            "node": "AI æ™ºèƒ½ä½“",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "180d054f-a9c0-4aa3-a7f7-e0db081b3031",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "98e897a176d6aa8f9ebfef8f0306eab4fec5c697c6120f66479530a2b348cfea"
  },
  "id": "7vXYSBgdQtdJDgfd",
  "tags": []
}